// Модуль работы с моделями данных
// Содержит структуры и функции для работы с бизнес-объектами

#Область ОписаниеПеременных

Перем КэшМоделей;

#КонецОбласти

#Область ПрограммныйИнтерфейс

// Создает новую модель пользователя
//
// Параметры:
//  Имя - Строка - имя пользователя
//  Email - Строка - email пользователя
//  Возраст - Число - возраст пользователя
//
// Возвращаемое значение:
//  Структура - модель пользователя
//
Функция СоздатьПользователя(Имя, Email, Возраст = 0) Экспорт

    Пользователь = Новый Структура;
    Пользователь.Вставить("Имя", Имя);
    Пользователь.Вставить("Email", Email);
    Пользователь.Вставить("Возраст", Возраст);
    Пользователь.Вставить("ДатаСоздания", ТекущаяДата());
    Пользователь.Вставить("Активен", Истина);

    Возврат Пользователь;

КонецФункции

// Валидирует модель пользователя
//
// Параметры:
//  Пользователь - Структура - модель пользователя для валидации
//
// Возвращаемое значение:
//  Структура - результат валидации с полями "Успех" и "Ошибки"
//
Функция ВалидироватьПользователя(Пользователь) Экспорт

    Результат = Новый Структура("Успех, Ошибки", Истина, Новый Массив);

    Если Не Пользователь.Свойство("Имя") Или ПустаяСтрока(Пользователь.Имя) Тогда
        Результат.Успех = Ложь;
        Результат.Ошибки.Добавить("Имя обязательно для заполнения");
    КонецЕсли;

    Если Не Пользователь.Свойство("Email") Или ПустаяСтрока(Пользователь.Email) Тогда
        Результат.Успех = Ложь;
        Результат.Ошибки.Добавить("Email обязателен для заполнения");
    ИначеЕсли Не ПроверитьEmail(Пользователь.Email) Тогда
        Результат.Успех = Ложь;
        Результат.Ошибки.Добавить("Некорректный формат Email");
    КонецЕсли;

    Если Пользователь.Свойство("Возраст") И Пользователь.Возраст < 0 Тогда
        Результат.Успех = Ложь;
        Результат.Ошибки.Добавить("Возраст не может быть отрицательным");
    КонецЕсли;

    Возврат Результат;

КонецФункции

// Создает новую модель заказа
//
// Параметры:
//  НомерЗаказа - Строка - номер заказа
//  Пользователь - Структура - модель пользователя
//
// Возвращаемое значение:
//  Структура - модель заказа
//
Функция СоздатьЗаказ(НомерЗаказа, Пользователь) Экспорт

    Заказ = Новый Структура;
    Заказ.Вставить("НомерЗаказа", НомерЗаказа);
    Заказ.Вставить("Пользователь", Пользователь);
    Заказ.Вставить("Товары", Новый Массив);
    Заказ.Вставить("Сумма", 0);
    Заказ.Вставить("Статус", "Новый");
    Заказ.Вставить("ДатаСоздания", ТекущаяДата());

    Возврат Заказ;

КонецФункции

// Добавляет товар в заказ
//
// Параметры:
//  Заказ - Структура - модель заказа
//  Товар - Структура - модель товара
//
Процедура ДобавитьТоварВЗаказ(Заказ, Товар) Экспорт

    Заказ.Товары.Добавить(Товар);
    Заказ.Сумма = Заказ.Сумма + Товар.Цена * Товар.Количество;

КонецПроцедуры

// Создает модель товара
//
// Параметры:
//  Наименование - Строка - название товара
//  Цена - Число - цена товара
//  Количество - Число - количество
//
// Возвращаемое значение:
//  Структура - модель товара
//
Функция СоздатьТовар(Наименование, Цена, Количество = 1) Экспорт

    Товар = Новый Структура;
    Товар.Вставить("Наименование", Наименование);
    Товар.Вставить("Цена", Цена);
    Товар.Вставить("Количество", Количество);

    Возврат Товар;

КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Локальная функция проверки email
Функция ПроверитьEmail(Email)

    Если ПустаяСтрока(Email) Тогда
        Возврат Ложь;
    КонецЕсли;

    ПозицияСобаки = СтрНайти(Email, "@");
    Возврат ПозицияСобаки > 0;

КонецФункции

// Инициализация кэша
Процедура ИнициализироватьКэш()
    КэшМоделей = Новый Соответствие;
КонецПроцедуры

#КонецОбласти

ИнициализироватьКэш();
